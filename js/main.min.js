// // 'use strict';

AOS.init({
  duration: 1300,
});

let mobile_menu_btn = document.querySelector(".mobile-menu-btn");
let mainMenu = document.getElementById("nav");

mobile_menu_btn.addEventListener("click", toggleMenu);

function toggleMenu() {
  this.classList.toggle("open");
  mainMenu.classList.toggle("open");
}

jQuery(function ($) {
  $(".promo-block__inn").slick({
    slidesToShow: 1,
    arrows: false,
    dots: true,
    appendDots: ".promo-block__dots",
    infinite: true,
    autoplay: true,
    autoplaySpeed: 2000,
  });

  $(".lp-rew__wr").slick({
    slidesToShow: 3,
    arrows: false,
    dots: false,
    autoplay: true,
    autoplaySpeed: 2000,
    infinite: true,
  });

  $(".video-popup").magnificPopup({
    type: "iframe",
    iframe: {
      patterns: {
        youtube: {
          index: "youtube.com/",
          id: function (url) {
            var m = url.match(/[\\?\\&]v=([^\\?\\&]+)/);
            if (!m || !m[1]) return null;
            return m[1];
          },
          src: "//www.youtube.com/embed/%id%?autoplay=1",
        },
        vimeo: {
          index: "vimeo.com/",
          id: function (url) {
            var m = url.match(
              /(https?:\/\/)?(www.)?(player.)?vimeo.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/
            );
            if (!m || !m[5]) return null;
            return m[5];
          },
          src: "//player.vimeo.com/video/%id%?autoplay=1",
        },
      },
    },
  });

  $(".modal-open").magnificPopup({
    type: "inline",
  });

  $('.books__filter input[type="radio"]').click(function () {
    $(".books__item").hide();

    var val1 = $("[name=age]:checked").val();
    var val2 = $("[name=programm]:checked").val();
    var val3 = $("[name=autor]:checked").val();

    $("." + val1).show();
    $("." + val2).show();
    $("." + val3).show();
  });

  $(".books__filter__reset").click(function (e) {
    e.preventDefault();

    $('.books__filter input[type="radio"]').removeAttr("checked");
    $(".books__item").show();
  });

  $(".lp-block6 .single_add_to_cart_button").addClass("btn");
  // $('.lp-block6 .single_add_to_cart_button').text('Подписаться')

  $(".scroll-to").click(function () {
    var el = $(this).attr("href");
    var elWrapped = $(el);
    scrollToDiv(elWrapped, 20);
    return false;
  });

  function scrollToDiv(element, navheight) {
    var offset = element.offset();
    var offsetTop = offset.top;
    var totalScroll = offsetTop - navheight;
    $("body,html").animate(
      {
        scrollTop: totalScroll,
      },
      1000
    );
  }

  let tabs__nav;

  $(".tabs__nav a").click(function (e) {
    e.preventDefault();

    tabs__nav = $(this).attr("href");

    $(".tabs__nav a").removeClass("active");

    $(this).addClass("active");

    $(".lp-block7__wr").removeClass("open");

    $(tabs__nav).addClass("open");
  });

  let buyOptionsItem;

  $(".buy-options__header").click(function () {
    if ($(this).hasClass("active")) {
    } else {
      // $('.buy-options__item input').prop('checked', false);

      $(".buy-options__header").removeClass("active");
      $(this).addClass("active");

      buyOptionsItem = $(this).closest(".buy-options__item");

      // $('.buy-options__body').removeClass('open')
      $(".buy-options__body").slideUp();
      // $(buyOptionsItem).find('.buy-options__body').addClass('open')
      $(buyOptionsItem).find(".buy-options__body").slideDown();

      // $(buyOptionsItem).find('label').first().find('input').prop('checked', true);
      // $(buyOptionsItem).find('label').first().find('input').trigger('click');
    }
  });

  $(".anons__text li").find("del").parents("li").addClass("del");

  $(".books__filter__reset").on("click", function () {
    $(".books__filter input").prop("checked", false);
    $(".books__item").show();
  });

  $(".books__filter input").on("click", function () {
    $(".books__filter input").each(function (indexInArray, valueOfElement) {
      $(".books__item").show();

      if ($(valueOfElement).prop("checked")) {
        setTimeout(() => {
          $(".books__item").hide();
        }, 1);

        setTimeout(() => {
          $($(valueOfElement).val()).show();
        }, 2);
      }
    });
  });

  $(".header__search").click(function () {
    $(".search-block").slideToggle();
  });

  // Popup after send cf7
  // document.addEventListener(
  //   "wpcf7mailsent ",
  //   function (event) {
  //     $.magnificPopup.open({
  //       items: {
  //         src: "#thanks",
  //         type: "inline",
  //       },
  //     });
  //     setTimeout(() => {
  //       $.magnificPopup.close();
  //     }, 1500);
  //   },
  //   false
  // );

  document.addEventListener( 'wpcf7mailsent', function( event ) {
    $.magnificPopup.open({
      items: {
        src: "#thanks",
        type: "inline",
      },
    });
    setTimeout(() => {
      $.magnificPopup.close();
    }, 1500);
  }, false );

  // Buy options toggle
  let buySubs;
  let buyOption;

  function findBuyOption() {
    buyOption = $("#book-items").find("input:checked").val();
    buySubs = $("#subs-items").find("input:checked").val();
  }

  $("#book-items label,#subs-items label,.single_add_to_cart_button").on(
    "click",
    function () {
      findBuyOption();
      $(".single_add_to_cart_button").val(buyOption + "," + buySubs);
    }
  );

  $("#subs-items label").first().trigger("click");
  $("#book-items label").first().trigger("click");
});