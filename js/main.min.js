// // 'use strict';

AOS.init({
  duration: 1300,
});

let mobile_menu_btn = document.querySelector(".mobile-menu-btn");
let mainMenu = document.getElementById("nav");

mobile_menu_btn.addEventListener("click", toggleMenu);

function toggleMenu() {
  this.classList.toggle("open");
  mainMenu.classList.toggle("open");
}

jQuery(function ($) {
  $(".promo-block__inn").slick({
    slidesToShow: 1,
    arrows: false,
    dots: true,
    appendDots: ".promo-block__dots",
    infinite: true,
    autoplay: true,
    autoplaySpeed: 2000,
  });

  $(".lp-rew__wr").slick({
    slidesToShow: 3,
    arrows: false,
    dots: false,
    autoplay: true,
    autoplaySpeed: 2000,
    infinite: true,
  });

  $(".video-popup,.videoobzor").magnificPopup({
    type: "iframe",
    iframe: {
      patterns: {
        youtube: {
          index: "youtube.com/",
          id: function (url) {
            var m = url.match(/[\\?\\&]v=([^\\?\\&]+)/);
            if (!m || !m[1]) return null;
            return m[1];
          },
          src: "//www.youtube.com/embed/%id%?autoplay=1",
        },
        vimeo: {
          index: "vimeo.com/",
          id: function (url) {
            var m = url.match(
              /(https?:\/\/)?(www.)?(player.)?vimeo.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/
            );
            if (!m || !m[5]) return null;
            return m[5];
          },
          src: "//player.vimeo.com/video/%id%?autoplay=1",
        },
      },
    },
  });

  $(".modal-open").magnificPopup({
    type: "inline",
  });

  // $('.books__filter input[type="radio"]').click(function () {
  //   $(".books__item,.lib-box").hide();

  //   var val1 = $("[name=age]:checked").val();
  //   var val2 = $("[name=programm]:checked").val();
  //   var val3 = $("[name=autor]:checked").val();
  //   var val3 = $("[name=autor]:checked").val();

  //   $("." + val1).show();
  //   $("." + val2).show();
  //   $("." + val3).show();
  // });

  // $(".books__filter__reset").click(function (e) {
  //   e.preventDefault();

  //   $('.books__filter input[type="radio"]').removeAttr("checked");
  //   $(".books__item").show();
  // });

  $(".lp-block6 .single_add_to_cart_button").addClass("btn");
  // $('.lp-block6 .single_add_to_cart_button').text('Подписаться')

  $(".scroll-to").click(function () {
    var el = $(this).attr("href");
    var elWrapped = $(el);
    scrollToDiv(elWrapped, 20);
    return false;
  });

  function scrollToDiv(element, navheight) {
    var offset = element.offset();
    var offsetTop = offset.top;
    var totalScroll = offsetTop - navheight;
    $("body,html").animate(
      {
        scrollTop: totalScroll,
      },
      1000
    );
  }

  let tabs__nav;

  $(".tabs__nav a").click(function (e) {
    e.preventDefault();

    tabs__nav = $(this).attr("href");

    $(".tabs__nav a").removeClass("active");

    $(this).addClass("active");

    $(".lp-block7__wr").removeClass("open");

    $(tabs__nav).addClass("open");
  });

  let buyOptionsItem;

  $(".buy-options__header").click(function () {
    if ($(this).hasClass("active")) {
    } else {
      // $('.buy-options__item input').prop('checked', false);

      $(".buy-options__header").removeClass("active");
      $(this).addClass("active");

      buyOptionsItem = $(this).closest(".buy-options__item");

      // $('.buy-options__body').removeClass('open')
      $(".buy-options__body").slideUp();
      // $(buyOptionsItem).find('.buy-options__body').addClass('open')
      $(buyOptionsItem).find(".buy-options__body").slideDown();

      // $(buyOptionsItem).find('label').first().find('input').prop('checked', true);
      // $(buyOptionsItem).find('label').first().find('input').trigger('click');
    }
  });

  $(".anons__text li").find("del").parents("li").addClass("del");

  // $(".books__filter__reset").on("click", function () {
  //   $(".books__filter input").prop("checked", false);
  //   $(".books__item,.lib-box").show();
  // });

  // $(".books__filter input").on("click", function () {
  //   $(".books__filter input").each(function (indexInArray, valueOfElement) {
  //     $(".books__item,.lib-box").show();

  //     if ($(valueOfElement).prop("checked")) {
  //       setTimeout(() => {
  //         $(".books__item,.lib-box").hide();
  //       }, 1);

  //       setTimeout(() => {
  //         $($(valueOfElement).val()).show();
  //         console.log($(valueOfElement).val());
  //       }, 2);
  //     }
  //   });
  // });



   $('#filter').submit(function() {
      var filter = $('#filter');
      $.ajax({
        url: filter.attr('action'),
        data: filter.serialize(), // form data
        type: filter.attr('method'), // POST
        beforeSend: function(xhr) {
          // $('body').addClass('no-scroll'); // changing the button label
          $('.ajax-overlay').addClass('active'); // changing the button label
        },
        success: function(data) {
          // $('body').removeClass('no-scroll'); // changing the button label back
          $('.ajax-overlay').removeClass('active'); // changing the button label back
          $('#response').html(data); // insert data
        }
      });
      return false;
    });

    $(".books__filter__item input").on("click", function () {
      $('.books__filter button').trigger('click');
    })

  

  $(".header__search").click(function () {
    $(".search-block").slideToggle();
  });





  $('.lib-excerpt').click(function (e) { 
    e.preventDefault();
    // $(this).toggleClass('open');
    $(this).find('.short').slideToggle();
    $(this).find('.long').slideToggle();
    
  });




  // Popup after send cf7
  // document.addEventListener(
  //   "wpcf7mailsent ",
  //   function (event) {
  //     $.magnificPopup.open({
  //       items: {
  //         src: "#thanks",
  //         type: "inline",
  //       },
  //     });
  //     setTimeout(() => {
  //       $.magnificPopup.close();
  //     }, 1500);
  //   },
  //   false
  // );

  document.addEventListener('wpcf7mailsent', function (event) {
    $.magnificPopup.open({
      items: {
        src: "#thanks",
        type: "inline",
      },
    });
    setTimeout(() => {
      $.magnificPopup.close();
    }, 1500);
  }, false);

  // Buy options toggle
  let buySubs;
  let buyOption;

  function findBuyOption() {
    buyOption = $("#book-items").find("input:checked").val();
    buySubs = $("#subs-items").find("input:checked").val();
  }

  $("#book-items label,#subs-items label,.single_add_to_cart_button").on(
    "click",
    function () {
      findBuyOption();
      $(".single_add_to_cart_button").val(buyOption + "," + buySubs);
    }
  );

  $("#subs-items label").first().trigger("click");
  $("#book-items label").first().trigger("click");


  $('.lib-spoiler__title').click(function () {
    $('.lib-spoiler__body').toggleClass('open');

  });


});





// Possible improvements:
// - Change timeline and volume slider into input sliders, reskinned
// - Change into Vue or React component
// - Be able to grab a custom title instead of "Music Song"
// - Hover over sliders to see preview of timestamp/volume change
















// const audioPlayer = document.querySelectorAll(".audio-player");
// let audioSrc;
// let audio;
// let timeline;
// let timelineWidth;
// let timeToSeek;
// let volumeSlider;
// let sliderWidth;
// let newVolume;
// let progressBar;
// let playBtn;

// audioPlayer.forEach(element => {

//   audioSrc = element.dataset.src;
//   console.log(audioSrc);

//   audio = new Audio(audioSrc);
 
//   audio.addEventListener(
//     "loadeddata",
//     () => {
//       element.querySelector(".time .length").textContent = getTimeCodeFromNum(
//         audio.duration
//       );
//       audio.volume = .75;
//     },
//     false
//   );

//   //click on timeline to skip around
//   timeline = element.querySelector(".timeline");
//   timeline.addEventListener("click", e => {
//     timelineWidth = window.getComputedStyle(timeline).width;
//     timeToSeek = e.offsetX / parseInt(timelineWidth) * audio.duration;
//     audio.currentTime = timeToSeek;
//   }, false);




//   //click volume slider to change volume
//   volumeSlider = element.querySelector(".controls .volume-slider");
//   volumeSlider.addEventListener('click', e => {
//     sliderWidth = window.getComputedStyle(volumeSlider).width;
//     newVolume = e.offsetX / parseInt(sliderWidth);
//     audio.volume = newVolume;
//     element.querySelector(".controls .volume-percentage").style.width = newVolume * 100 + '%';
//   }, false)

//   //check audio percentage and update time accordingly
//   setInterval(() => {
//     progressBar = element.querySelector(".progress");
//     progressBar.style.width = audio.currentTime / audio.duration * 100 + "%";
//     element.querySelector(".time .current").textContent = getTimeCodeFromNum(
//       audio.currentTime
//     );
//   }, 500);

//   //toggle between playing and pausing on button click
//   playBtn = element.querySelector(".controls .toggle-play");
//   playBtn.addEventListener(
//     "click",
//     () => {
//       if (audio.paused) {
//         playBtn.classList.remove("play");
//         playBtn.classList.add("pause");
//         audio.play();
//       } else {
//         playBtn.classList.remove("pause");
//         playBtn.classList.add("play");
//         audio.pause();
//       }
//     },
//     false
//   );

//   element.querySelector(".volume-button").addEventListener("click", () => {
//     const volumeEl = audioPlayer.querySelector(".volume-container .volume");
//     audio.muted = !audio.muted;
//     if (audio.muted) {
//       volumeEl.classList.remove("icono-volumeMedium");
//       volumeEl.classList.add("icono-volumeMute");
//     } else {
//       volumeEl.classList.add("icono-volumeMedium");
//       volumeEl.classList.remove("icono-volumeMute");
//     }
//   });

//   // //turn 128 seconds into 2:08

// });
// function getTimeCodeFromNum(num) {
//   let seconds = parseInt(num);
//   let minutes = parseInt(seconds / 60);
//   seconds -= minutes * 60;
//   const hours = parseInt(minutes / 60);
//   minutes -= hours * 60;

//   if (hours === 0) return `${minutes}:${String(seconds % 60).padStart(2, 0)}`;
//   return `${String(hours).padStart(2, 0)}:${minutes}:${String(
//     seconds % 60
//   ).padStart(2, 0)}`;
// }






